---
id: 79
title: struts2上传大小为0的文件问题解决
date: 2014-01-10T23:46:31+00:00
author: 李朝
layout: post
guid: http://www.lizhaoblog.com/?p=18
permalink: /archives/79
seo_follow:
  - 'false'
seo_noindex:
  - 'false'
categories:
  - java
  - struts
tags:
  - java
  - 文件上传
---
当struts上传大小为0kb的文件的时候，struts默认当文件不存在，后台接收的文件file.exist()的值为false；

我使用的struts版本为：2.1.8.1；其他版本可能会没有这个问题，未做测试；

参考：[Struts 2.3.1 GA 版发布](http://www.oschina.net/news/24050/struts-2-3-1-ga)

  * [[WW-3562](https://issues.apache.org/jira/browse/WW-3562)] – FileUploadInterceptor: File not uploaded when file is empty (0 bytes)

struts 配置有个属性struts.multipart.parser，该属性指定处理multipart/form-data的MIME类型（文件上传）请求的框架，该属性支持cos、pell和jakarta等属性值，即分别对应使用cos的文件上传框架、pell上传及common-fileupload文件上传框架。该属性的默认值为jakarta。

为jakarta时候，如果上传的文件大小为0kb，则struts读取文件则是不存在的：

<pre class="brush: java; title: ; notranslate" title="">When not selecting any file to upload in a file input, Struts does not ignore the 0 byte file
returned by jakarta FileUpload.
This means that a file is injected in the action even if nothing was uploaded.

In webwork the check was done in the constructor of  com.opensymphony.webwork.dispatcher.multipart.JakartaMultiPartRequest:

else if (item.getSize() == 0) {
log.warn("Item is a file upload of 0 size, ignoring");
}

In struts the parsing of the request moved from the constructor to a parse method but the
above check disappeared.

Additionally this behaviour is inconsistant with the "pell" implementation that ignores 0
byte files.

--
This message is automatically generated by JIRA.
</pre>

这里是STRUTS\_MULTIPART\_PARSER的官方文档说明：

### STRUTS\_MULTIPART\_PARSER
		  


public static final [String](http://download.oracle.com/javase/1.5.0/docs/api/java/lang/String.html?is-external=true "class or interface in java.lang") **STRUTS\_MULTIPART\_PARSER**
:   The org.apache.struts2.dispatcher.multipart.MultiPartRequest parser implementation for a multipart request (file upload)</p> 
    
    **See Also:** 
    :   [Constant Field Values](http://tool.oschina.net/uploads/apidocs/struts-2.3.4/constant-values.html#org.apache.struts2.StrutsConstants.STRUTS_MULTIPART_PARSER) 

注意  如果需要使用cos或者pell的文件上传方式，则应该将对应的JAR文件复制到Web应用中。
  
例如，使用cos上传方式，则需要自己下载cos框架的JAR文件，并将该文件放在WEB-INF/lib路径下。但是我测试仍然为通过，原因未知。

解决办法2：

<pre class="brush: java; title: ; notranslate" title="">if (!srcFile.exists()) {
 try {
   destFile.createNewFile();//创建空文件
 } catch (IOException e) {
   LogUtil.error(e);
   return;
 }
} else {
//文件操作
}</pre>

参考：

[struts2 的struts.properties配置详解](http://87029274.iteye.com/blog/1478095)

<http://www.iteye.com/problems/19141></dd> </dl> </dd> </dl>